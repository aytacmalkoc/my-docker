services:
  # PHP 7.3 FPM Container
  php73:
    build:
      context: ./php73
      dockerfile: Dockerfile
    container_name: dockerdevphp_php73
    volumes:
      - ./projects/php73-projects:/var/www/html
      - ./php73/php.ini:/usr/local/etc/php/php.ini
    networks:
      - php_network
    depends_on:
      - mysql
      - postgresql
      - mongodb
    environment:
      - PHP_IDE_CONFIG=serverName=php73
    restart: unless-stopped

  # PHP 7.4 FPM Container
  php74:
    build:
      context: ./php74
      dockerfile: Dockerfile
    container_name: dockerdevphp_php74
    volumes:
      - ./projects/php74-projects:/var/www/html
      - ./php74/php.ini:/usr/local/etc/php/php.ini
    networks:
      - php_network
    depends_on:
      - mysql
      - postgresql
      - mongodb
    environment:
      - PHP_IDE_CONFIG=serverName=php74
    restart: unless-stopped

  # PHP 8.3 FPM Container
  php83:
    build:
      context: ./php83
      dockerfile: Dockerfile
    container_name: dockerdevphp_php83
    volumes:
      - ./projects/php83-projects:/var/www/html
      - ./php83/php.ini:/usr/local/etc/php/php.ini
    networks:
      - php_network
    depends_on:
      - mysql
      - postgresql
      - mongodb
      - redis
    environment:
      - PHP_IDE_CONFIG=serverName=php83
    restart: unless-stopped

  # PHP 8.1 FPM Container
  php81:
    build:
      context: ./php81
      dockerfile: Dockerfile
    container_name: dockerdevphp_php81
    volumes:
      - ./projects/php81-projects:/var/www/html
      - ./php81/php.ini:/usr/local/etc/php/php.ini
    networks:
      - php_network
    depends_on:
      - mysql
      - postgresql
      - mongodb
    environment:
      - PHP_IDE_CONFIG=serverName=php81
    restart: unless-stopped

  # PHP 8.4 FPM Container
  php84:
    build:
      context: ./php84
      dockerfile: Dockerfile
    container_name: dockerdevphp_php84
    volumes:
      - ./projects/php84-projects:/var/www/html
      - ./php84/php.ini:/usr/local/etc/php/php.ini
    networks:
      - php_network
    depends_on:
      - mysql
      - postgresql
      - mongodb
      - redis
    environment:
      - PHP_IDE_CONFIG=serverName=php84
    restart: unless-stopped

  # Nginx Web Server
  nginx:
    image: nginx:alpine
    container_name: dockerdevphp_nginx
    ports:
      - "8000:80"
      - "8001:81"
      - "8002:82"
      - "8003:83"
      - "8004:84"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./projects/php73-projects:/var/www/html73:ro
      - ./projects/php74-projects:/var/www/html74:ro
      - ./projects/php81-projects:/var/www/html81:ro
      - ./projects/php83-projects:/var/www/html83:ro
      - ./projects/php84-projects:/var/www/html84:ro
    networks:
      - php_network
    depends_on:
      - php73
      - php74
      - php81
      - php83
      - php84
    restart: unless-stopped

  # MySQL Database
  mysql:
    image: mysql:8.0
    container_name: dockerdevphp_mysql
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: dev_db
      MYSQL_USER: dev_user
      MYSQL_PASSWORD: dev_password
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    networks:
      - php_network
    restart: unless-stopped
    command: --default-authentication-plugin=mysql_native_password

  # PostgreSQL Database
  postgresql:
    image: postgres:15-alpine
    container_name: dockerdevphp_postgresql
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: dev_user
      POSTGRES_PASSWORD: dev_password
      POSTGRES_DB: dev_db
    volumes:
      - postgresql_data:/var/lib/postgresql/data
      - ./postgresql/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    networks:
      - php_network
    restart: unless-stopped

  # MongoDB Database
  mongodb:
    image: mongo:7
    container_name: dockerdevphp_mongodb
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: dev_user
      MONGO_INITDB_ROOT_PASSWORD: dev_password
      MONGO_INITDB_DATABASE: dev_db
    volumes:
      - mongodb_data:/data/db
    networks:
      - php_network
    restart: unless-stopped

  # Redis Cache
  redis:
    image: redis:7-alpine
    container_name: dockerdevphp_redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - php_network
    restart: unless-stopped
    command: redis-server --appendonly yes

  # phpMyAdmin
  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    container_name: dockerdevphp_phpmyadmin
    ports:
      - "8080:80"
    environment:
      PMA_HOST: mysql
      PMA_PORT: 3306
      PMA_USER: root
      PMA_PASSWORD: root
      MYSQL_ROOT_PASSWORD: root
    networks:
      - php_network
    depends_on:
      - mysql
    restart: unless-stopped

  # pgAdmin (PostgreSQL Admin)
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: dockerdevphp_pgadmin
    ports:
      - "8081:80"
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@admin.com
      PGADMIN_DEFAULT_PASSWORD: admin
      PGADMIN_CONFIG_SERVER_MODE: 'False'
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    networks:
      - php_network
    depends_on:
      - postgresql
    restart: unless-stopped

  # mongo-express (MongoDB Admin)
  mongo-express:
    image: mongo-express:latest
    container_name: dockerdevphp_mongo-express
    ports:
      - "8082:8081"
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: dev_user
      ME_CONFIG_MONGODB_ADMINPASSWORD: dev_password
      ME_CONFIG_MONGODB_SERVER: mongodb
      ME_CONFIG_MONGODB_PORT: 27017
      ME_CONFIG_BASICAUTH_USERNAME: admin
      ME_CONFIG_BASICAUTH_PASSWORD: admin
    networks:
      - php_network
    depends_on:
      - mongodb
    restart: unless-stopped

volumes:
  mysql_data:
    driver: local
  postgresql_data:
    driver: local
  pgadmin_data:
    driver: local
  redis_data:
    driver: local
  mongodb_data:
    driver: local

networks:
  php_network:
    driver: bridge

